<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>대구자립지원전담기관_상담조회</title>
    <link rel="stylesheet" href="../css/counselor.css" />
</head>

<body>
    <div class="wrapper">
        <h2>상담조회</h2>
        <table>
            <tr class="table_tr">
                <td>신청자명</td>
                <td>문의유형</td>
                <td>문의시간</td>
            </tr>
            <tr>
                <td id="Inquirer_name">
                    <%= data.Inquirer_name %>
                </td>
                <td id="Inquiry_type">
                    <%= data.Inquiry_type %>
                </td>
                <td id="Inquiry_time">
                    <% const date=new Date(data.Inquiry_time); const year=date.getFullYear(); const
                        month=String(date.getMonth() + 1).padStart(2, '0' ); const
                        day=String(date.getDate()).padStart(2, '0' ); const weekdays=['일', '월' , '화' , '수' , '목' , '금'
                        , '토' ]; const weekday=weekdays[date.getDay()]; const
                        hours=String(date.getHours()).padStart(2, '0' ); const
                        minutes=String(date.getMinutes()).padStart(2, '0' ); const
                        seconds=String(date.getSeconds()).padStart(2, '0' ); %>
                        <%- `${year}.${month}.${day}(${weekday})<br>${hours}:${minutes}:${seconds}` %>
                </td>
            </tr>
        </table>
        <form id="form">
            <div class="box">
                <h4 class="q">문의내용</h4>
                <textarea id="inquiry_details" class="form_detail" name="form_detail" rows="7"
                    readonly><%= data.inquiry_details %></textarea>
            </div>
        </form>

        <h2>조치내용</h2>
        <form id="counselingForm" method="POST" action="/submit">
            <input type="hidden" id="id" name="id" value="<%= data.Id %>">

            <div class="box_s">
                <div class="box_s_wrapper">
                    <h4 class="content">상담내용</h4>
                </div>
                <div class="after">
                    <textarea id="counselingDetails" class="counselingDetails" name="Counseling_details" rows="7"
                        required placeholder="상담시간 및 상담 내용을 입력해주세요."></textarea>
                </div>
            </div>
            <table class="counseling_name">
                <tr class="table_tr name_table">
                    <td style="width: 30%;">상담자명</td>
                    <td>상담유형</td>
                </tr>
                <tr>
                    <td>
                        <input class="name_input" id="Counselor_name" name="Counselor_name" type="text" required />
                    </td>
                    <td>
                        <div class="input_box">
                            <label><input type="radio" name="Counseling_type" value="전화상담" required checked>전화상담</label>
                            <label><input type="radio" name="Counseling_type" value="방문상담" required>방문상담</label>
                        </div>
                    </td>
                </tr>
            </table>

            <!-- Checkbox -->
            <label><input class="check" type="checkbox" id="double_check" required>작성을 완료하였습니다.</label>

            <!-- Submit Button -->
            <button id="agree_button" type="submit">상담완료</button>
        </form>
    </div>


    <script>
        $(document).ready(function () {
            $('#counselingForm').on('submit', function (e) {
                e.preventDefault(); // 폼의 기본 제출 동작을 막습니다.

                const counselingType = $('input[name="counselingType"]:checked').val();
                const counselingDetails = $('#counselingDetails').val();
                const Counselor_name = $('#Counselor_name').val();

                // 현재 시간을 timestamp로 변환합니다.
                const date = new Date();
                const counselingDate = date.getTime();

                const id = $('#id').val();
                console.log(id);

                $.ajax({
                    url: '/submit', // 실제 데이터를 전송할 서버의 URL로 변경해야 합니다.
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        id: id,
                        Counseling_type: counselingType,
                        Counseling_details: counselingDetails,
                        Counselor_name: Counselor_name,
                        Counseling_in_progress: true,
                    }),
                    success: function (data) {
                        console.log('Data sent successfully');
                        // 추가적인 성공 처리 로직
                    },
                    error: function (err) {
                        console.log('Error:', err);
                        // 에러 처리 로직
                    }
                });
            });
        });
    </script>
</body>

</html>